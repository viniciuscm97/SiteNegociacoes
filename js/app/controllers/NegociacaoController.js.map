{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacaoController","$","document","querySelector","bind","_inputQuantidade","_inputData","_inputValor","_inputTipo","querySelectorAll","_ordemAtual","_service","NegociacaoService","_listaNegociacoes","Bind","ListaNegociacoes","NegociacoesView","_mensagem","Mensagem","MensagemView","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","importaNegociacoes","event","preventDefault","criaNegociacao","cadastra","mensagem","_limpaFormulario","value","e","checked","focus","apaga","esvazia","importa","campo","inverteOrdem","ordena","a","b","Factory","createNegociacao","DateHelper","textoParaData","parseInt","parseFloat"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["class NegociacaoController {\r\n\r\n    constructor(){\r\n        let $ = document.querySelector.bind(document);\r\n\r\n        this._inputQuantidade = $('#quantidade')\r\n        this._inputData = $('#data')\r\n        this._inputValor = $('#valor')\r\n        this._inputTipo = document.querySelectorAll('#tipo')\r\n\r\n        this._ordemAtual = '';\r\n    \r\n        this._service = new NegociacaoService()\r\n    \r\n        this._listaNegociacoes = new Bind(\r\n            new ListaNegociacoes(),\r\n            new NegociacoesView($('#negociacoesView')),\r\n            'adiciona','esvazia', 'ordena', 'inverteOrdem')\r\n\r\n        this._mensagem = new Bind(\r\n            new Mensagem(),\r\n            new MensagemView($(\"#mensagemView\")),\r\n            'texto'\r\n        )\r\n        \r\n        this._init()\r\n    }\r\n    \r\n    _init() {\r\n\r\n        this._service\r\n            .lista()\r\n            .then(negociacoes => negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao)))\r\n            .catch(erro =>  this._mensagem.texto = erro)\r\n\r\n\r\n            setInterval(() => {\r\n                this.importaNegociacoes()\r\n            }, 3000)\r\n        \r\n    }\r\n\r\n    adiciona(event){        \r\n\r\n        event.preventDefault()\r\n        \r\n        let negociacao = this.criaNegociacao()\r\n\r\n        this._service\r\n        .cadastra(negociacao)\r\n        .then( mensagem => {\r\n            this._listaNegociacoes.adiciona(negociacao)\r\n            this._mensagem.texto = mensagem\r\n            this._limpaFormulario()\r\n        })\r\n        .catch( erro => this._mensagem.texto = erro)\r\n        \r\n        \r\n    }\r\n\r\n    _limpaFormulario(){\r\n        this._inputData.value = ''\r\n        this._inputQuantidade.value = 1\r\n        this._inputValor.value =  0.0\r\n        this._inputTipo.forEach(e => e.checked =false)\r\n\r\n        this._inputData.focus()\r\n    }\r\n\r\n    apaga(){\r\n\r\n        this._service\r\n            .apaga()\r\n            .then(mensagem => {\r\n                this._listaNegociacoes.esvazia()\r\n                this._mensagem.texto = mensagem})\r\n            .catch(erro => this._mensagem.texto = erro )\r\n\r\n    }\r\n\r\n    importaNegociacoes(){\r\n        this._service\r\n            .importa(this._listaNegociacoes.negociacoes)\r\n            .then(negociacoes => {\r\n                negociacoes.forEach(e => this._listaNegociacoes.adiciona(e))\r\n                this._mensagem.texto = \"Negociações importadas com sucesso\"})\r\n            .catch(erro => this._mensagem.texto = erro)\r\n       \r\n    }\r\n\r\n\r\n    ordena(campo){\r\n\r\n        if(this._ordemAtual == campo) {\r\n            this._listaNegociacoes.inverteOrdem()\r\n        } else {\r\n            this._listaNegociacoes.ordena((a, b) => a[campo] - b[campo]);\r\n        }\r\n        this._ordemAtual = campo;\r\n    }\r\n\r\n    criaNegociacao(){\r\n        let negociacao = Factory.createNegociacao(this._inputTipo,\r\n            {'date':DateHelper.textoParaData(this._inputData.value),\r\n            'quantidade':parseInt( this._inputQuantidade.value),\r\n            'valor':parseFloat(this._inputValor.value)});\r\n        return negociacao\r\n    }\r\n\r\n\r\n\r\n}"]}